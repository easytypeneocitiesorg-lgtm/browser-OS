<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BrowserOS</title>
<style>
html, body { margin:0; padding:0; height:100%; font-family:sans-serif; overflow:hidden; background:#1a1a1a; color:white; }
#bootScreen,#keyScreen,#desktop,#shutdownScreen{ position:absolute; top:0; left:0; width:100%; height:100%; display:flex; justify-content:center; align-items:center; flex-direction:column; transition:opacity 1s; }
#bootScreen{ background:black; font-size:2em; z-index:3; }
#keyScreen{ background:#222; z-index:2; flex-direction:column; display:none; }
#desktop{ background:url('wallpaper.jpg') no-repeat center center fixed; background-size:cover; z-index:1; display:none; position:relative; }
#watermark{ position:fixed; bottom:10px; right:10px; font-size:24px; color:gray; opacity:0.7; pointer-events:none; z-index:999; display:none; }
input,button{ padding:5px; margin:5px; font-size:1em; }
.app{ position:absolute; width:100px; height:100px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; }
.window{ position:absolute; background:#333; color:white; border:1px solid #666; min-width:200px; min-height:100px; display:flex; flex-direction:column; }
.titlebar{ background:#555; padding:5px; cursor:move; display:flex; justify-content:space-between; align-items:center; }
.titlebar button{ margin-left:5px; }
.content{ flex:1; padding:5px; overflow:auto; }
.file,.folder{ background:#777; color:white; padding:5px; margin:2px; cursor:pointer; }
#taskbar{ position:fixed; bottom:0; left:0; right:0; height:40px; background:#222; display:flex; align-items:center; padding:0 5px; }
#startMenu{ position:absolute; bottom:40px; left:0; background:#333; padding:5px; display:none; flex-direction:column; }
.taskbarIcon{ width:30px; height:30px; margin-right:5px; cursor:pointer; display:flex; justify-content:center; align-items:center; background:#555; color:white; }
#loadingWheel{ display:inline-block; border:3px solid rgba(255,255,255,0.3); border-radius:50%; border-top:3px solid white; width:20px; height:20px; animation: spin 1s linear infinite; }
@keyframes spin{ 0%{ transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
#fileExplorerContent .file,.folder{ background:#777; color:white; padding:5px; margin:2px; display:inline-block; width:100px; text-align:center; cursor:pointer; }
#folders{ margin-bottom:5px; }
</style>
</head>
<body>

<div id="bootScreen">
  BrowserOS<br>
  <span id="bootLoading"><span id="loadingWheel"></span> Loading...</span>
</div>

<div id="keyScreen">
  <h2>Enter Product Key</h2>
  <input type="text" id="productKey" placeholder="EXAMPLE.PRODUCT.KEY.VALUE">
  <button onclick="activateKey()">Activate</button>
  <button onclick="skipActivation()">I don't have a product key</button>
</div>

<div id="desktop">
  <!-- App icons -->
  <div class="app" id="calculator" style="top:50px; left:50px;" onclick="openApp('Calculator')">
    <img src="calculator.png" width="64"><span>Calculator</span>
  </div>
  <div class="app" id="recycleBin" style="top:50px; left:200px;" onclick="openApp('RecycleBin')">
    <img src="recycle.png" width="64"><span>Recycle Bin</span>
  </div>
  <div class="app" id="fileExplorer" style="top:50px; left:350px;" onclick="openApp('FileExplorer')">
    <img src="folder.png" width="64"><span>File Explorer</span>
  </div>
  <div class="app" id="browser" style="top:50px; left:500px;" onclick="openApp('Browser')">
    <img src="browser.png" width="64"><span>Browser</span>
  </div>
</div>

<div id="shutdownScreen" style="display:none; flex-direction:column; justify-content:center; align-items:center;">
  Shutting down BrowserOS<br>
  <span><span id="loadingWheel2"></span> Loading...</span>
</div>

<div id="watermark">Activate BrowserOS</div>

<div id="taskbar">
  <button onclick="toggleStartMenu()">Menu</button>
  <div id="taskbarIcons" style="display:flex;"></div>
</div>
<div id="startMenu">
  <button onclick="shutdownOS()">Shutdown</button>
</div>

<script>
// --- Token system ---
let token = localStorage.getItem('bos_token');
if(!token){ token='tok_'+Math.random().toString(36).substring(2,12); localStorage.setItem('bos_token', token); }
let activated=false;

// --- Boot screen ---
setTimeout(()=>{
  document.getElementById('bootScreen').style.opacity=0;
  setTimeout(()=>{
    document.getElementById('bootScreen').style.display='none';
    document.getElementById('keyScreen').style.display='flex';
  },1000);
},7000);

// --- Activation ---
async function activateKey(){
  const key=document.getElementById('productKey').value.trim();
  if(!key){ alert('Enter a key'); return; }
  try{
    const keysResp=await fetch('https://github.com/easytypeneocitiesorg-lgtm/browser-OS/raw/refs/heads/main/keys.txt');
    const keysTxt=await keysResp.text();
    const keys=keysTxt.split('/').map(k=>k.trim()).filter(Boolean);
    if(!keys.includes(key)){ alert('Key not found'); return; }
    const bindings=JSON.parse(localStorage.getItem('bos_bindings')||'{}');
    if(!bindings[key]){ bindings[key]=token; localStorage.setItem('bos_bindings', JSON.stringify(bindings)); activated=true; enterDesktop(); }
    else if(bindings[key]===token){ activated=true; enterDesktop(); }
    else { alert('Key already used by another device'); }
  }catch(e){ console.error(e); alert('Error fetching keys'); }
}

function skipActivation(){
  document.getElementById('keyScreen').style.display='none';
  document.getElementById('desktop').style.display='block';
  document.getElementById('watermark').style.display='block';
}

function enterDesktop(){
  document.getElementById('keyScreen').style.display='none';
  document.getElementById('desktop').style.display='block';
}

// --- Shutdown ---
function shutdownOS(){
  document.getElementById('desktop').style.display='none';
  const s=document.getElementById('shutdownScreen');
  s.style.display='flex';
  setTimeout(()=>{ s.innerHTML='<div style="background:black;width:100%;height:100%;"></div>'; },5000);
}

// --- Start Menu ---
function toggleStartMenu(){
  const m=document.getElementById('startMenu');
  m.style.display=(m.style.display==='flex')?'none':'flex';
}

// --- App Handling ---
let openWindows={};
function openApp(name){
  if(openWindows[name]) return;
  if((name==='FileExplorer'||name==='Calculator'||name==='Browser') && !activated){ alert('You must activate BrowserOS to use this app.'); return; }

  const win=document.createElement('div'); win.className='window'; win.style.top='100px'; win.style.left='100px';
  const title=document.createElement('div'); title.className='titlebar'; title.innerText=name;
  const btns=document.createElement('div');
  const closeBtn=document.createElement('button'); closeBtn.innerText='X';
  closeBtn.onclick=()=>{ document.body.removeChild(win); delete openWindows[name]; updateTaskbar(); };
  const minBtn=document.createElement('button'); minBtn.innerText='—';
  minBtn.onclick=()=>{ win.style.display='none'; addTaskbarIcon(name,win); };
  btns.appendChild(minBtn); btns.appendChild(closeBtn);
  title.appendChild(btns);
  win.appendChild(title);

  const content=document.createElement('div'); content.className='content';
  if(name==='Calculator'){ content.innerHTML='Calculator app placeholder'; }
  else if(name==='RecycleBin'){ content.innerHTML='Recycle Bin placeholder'; }
  else if(name==='FileExplorer'){ content.appendChild(createFileExplorer()); }
  else if(name==='Browser'){ content.innerHTML='<iframe src="https://example.com" width="100%" height="100%"></iframe>'; }

  win.appendChild(content);
  document.body.appendChild(win);
  openWindows[name]=win;
  makeDraggable(win,title);
}

function makeDraggable(win,title){
  let offsetX=0, offsetY=0, dragging=false;
  title.onmousedown=(e)=>{ dragging=true; offsetX=e.clientX-win.offsetLeft; offsetY=e.clientY-win.offsetTop; };
  document.onmouseup=()=>dragging=false;
  document.onmousemove=(e)=>{ if(dragging){ win.style.left=(e.clientX-offsetX)+'px'; win.style.top=(e.clientY-offsetY)+'px'; } };
}

function addTaskbarIcon(name,win){
  const tb=document.getElementById('taskbarIcons');
  const icon=document.createElement('div'); icon.className='taskbarIcon'; icon.innerText=name;
  icon.onclick=()=>{ win.style.display='flex'; tb.removeChild(icon); };
  tb.appendChild(icon);
}

function updateTaskbar(){}

// --- File System ---
let files={Desktop:[],Downloads:[],Documents:[],Pictures:[]};

function importFile(name,code){
  if(!activated){ alert('You must activate BrowserOS to import files.'); return; }
  const file={name:name,code:code};
  files.Downloads.push(file);
  addFileIcon(file,'Downloads');
}

function addFileIcon(file,folder){
  const app=document.createElement('div'); app.className='app';
  app.style.top=Math.random()*300+50+'px'; app.style.left=Math.random()*300+50+'px';
  app.innerHTML='<img src="file.png" width="64"><span>'+file.name+'</span>';
  app.onclick=()=>{ openFile(file); };
  document.getElementById('desktop').appendChild(app);
}

function openFile(file){
  if(!activated){ alert('You must activate BrowserOS to open files.'); return; }
  const win=document.createElement('div'); win.className='window';
  win.style.top='120px'; win.style.left='120px';
  const title=document.createElement('div'); title.className='titlebar'; title.innerText=file.name;
  const btns=document.createElement('div');
  const closeBtn=document.createElement('button'); closeBtn.innerText='X';
  closeBtn.onclick=()=>document.body.removeChild(win);
  const minBtn=document.createElement('button'); minBtn.innerText='—';
  minBtn.onclick=()=>win.style.display='none';
  btns.appendChild(minBtn); btns.appendChild(closeBtn);
  title.appendChild(btns);
  win.appendChild(title);
  const content=document.createElement('div'); content.className='content'; content.innerHTML=file.code;
  win.appendChild(content);
  document.body.appendChild(win);
  makeDraggable(win,title);
}

// --- File Explorer ---
function createFileExplorer(){
  const explorer=document.createElement('div');
  explorer.id='fileExplorerContent';
  const folderBar=document.createElement('div'); folderBar.id='folders';
  ['Desktop','Downloads','Documents','Pictures'].forEach(f=>{
    const b=document.createElement('button'); b.innerText=f;
    b.onclick=()=>showFolder(f);
    folderBar.appendChild(b);
  });
  explorer.appendChild(folderBar);
  const contentArea=document.createElement('div'); contentArea.id='folderFiles';
  explorer.appendChild(contentArea);
  showFolder('Desktop');
  return explorer;
}

function showFolder(name){
  const contentArea=document.getElementById('folderFiles');
  contentArea.innerHTML='';
  files[name].forEach(f=>{
    const el=document.createElement('div');
    el.className='file'; el.innerText=f.name;
    el.onclick=()=>openFile(f);
    contentArea.appendChild(el);
  });
}
</script>

</body>
</html>
