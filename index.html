<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BrowserOS</title>
<style>
html,body{margin:0;padding:0;width:100%;height:100%;font-family:Arial, sans-serif;overflow:hidden;}
body{background:black;}
.screen{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center;transition:opacity 0.5s;}
#bootScreen,#productKeyScreen,#desktopScreen,#shutdownScreen{display:none;flex-direction:column;color:white;}
#bootScreen,#shutdownScreen{background:#111;flex-direction:column;}
#desktopScreen{background-size:cover;background-position:center;overflow:hidden;background-image:url('https://copilot.microsoft.com/th/id/BCO.99351b73-c924-4ea6-8114-a3d2e0e35372.png');}
#desktopScreen .icon{width:80px;text-align:center;cursor:grab;position:absolute;}
#desktopScreen .icon img{width:64px;height:64px;display:block;margin:0 auto;}
#taskbar{position:absolute;bottom:0;left:0;width:100%;height:40px;background:rgba(0,0,0,0.7);display:flex;align-items:center;padding:0 5px;box-sizing:border-box;}
#startButton{width:60px;height:30px;background:#444;color:white;cursor:pointer;display:flex;justify-content:center;align-items:center;margin-right:5px;}
.window{position:absolute;background:#ddd;border:1px solid #888;width:400px;height:300px;box-shadow:2px 2px 10px rgba(0,0,0,0.5);display:flex;flex-direction:column;}
.window-header{background:#555;color:white;padding:5px;cursor:move;display:flex;justify-content:space-between;align-items:center;}
.window-content{flex:1;padding:5px;background:#fff;overflow:auto;}
.window-buttons button{margin-left:2px;}
#watermark{position:absolute;bottom:10px;right:10px;color: rgba(128,128,128,0.6);font-size:32px;pointer-events:none;z-index:9999;display:none;}
#clockWidget{position:absolute;top:5px;right:10px;color:white;font-size:16px;pointer-events:none;}
input,button,textarea{font-size:14px;}
.loading{border:8px solid #f3f3f3;border-top:8px solid #555;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;margin-top:20px;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
.folder-list{list-style-type:none;padding-left:0;background:#555;color:white;padding:10px;border-radius:5px;}
.folder-list li{cursor:pointer;margin:3px 0;padding:3px 5px;border-radius:3px;}
.folder-list li:hover{background:#777;}
.breadcrumbs{margin-bottom:5px;}
#startMenu{position:absolute;bottom:40px;left:5px;background:rgba(50,50,50,0.95);color:white;padding:10px;border-radius:8px;display:none;flex-direction:column;z-index:10000;}
#startMenu button{margin:3px 0;width:150px;}
</style>
</head>
<body>

<!-- Boot Screen -->
<div id="bootScreen" class="screen">
  <h1>BrowserOS</h1>
  <div class="loading"></div>
</div>

<!-- Product Key Screen -->
<div id="productKeyScreen" class="screen">
  <h2>Enter Product Key</h2>
  <input type="text" id="productKeyInput" placeholder="XXXX.XXXX.XXXX.XXXX" />
  <div style="margin-top:10px;">
    <button id="submitKey">Submit</button>
    <button id="skipKey">I don't have a product key</button>
  </div>
</div>

<!-- Desktop -->
<div id="desktopScreen" class="screen">
  <div id="watermark">Activate BrowserOS</div>
  <div id="clockWidget"></div>

  <!-- Icons -->
  <div class="icon" id="iconCalculator" style="top:50px; left:50px;">
    <img src="https://img.icons8.com/fluency/48/calculator.png" />
    <span>Calculator</span>
  </div>
  <div class="icon" id="iconExplorer" style="top:150px; left:50px;">
    <img src="https://img.icons8.com/fluency/48/folder-invoices.png" />
    <span>File Explorer</span>
  </div>
  <div class="icon" id="iconRecycle" style="top:250px; left:50px;">
    <img src="https://img.icons8.com/fluency/48/recycle-bin.png" />
    <span>Recycle Bin</span>
  </div>
  <div class="icon" id="iconBrowser" style="top:350px; left:50px;">
    <img src="https://img.icons8.com/fluency/48/internet.png" />
    <span>Browser</span>
  </div>
  <div class="icon" id="iconWallpaper" style="top:450px; left:50px; cursor:pointer;">
    <img src="https://img.icons8.com/fluency/48/image.png" />
    <span>wallpaper.jpg</span>
  </div>

  <!-- Start Menu -->
  <div id="startMenu">
    <button id="newBOF">New .bof File</button>
  </div>

  <!-- Taskbar -->
  <div id="taskbar">
    <div id="startButton">Start</div>
    <div id="minimizedApps" style="display:flex;"></div>
    <button id="shutdownButton" style="margin-left:auto;">Shutdown</button>
  </div>
</div>

<!-- Shutdown Screen -->
<div id="shutdownScreen" class="screen">
  <h1>BrowserOS</h1>
  <div class="loading"></div>
  <p>Shutting down...</p>
</div>

<script>
// --- TOKEN & ACTIVATION ---
let token = localStorage.getItem('bos_token');
if(!token){ token='tok_'+Math.random().toString(36).substring(2,12); localStorage.setItem('bos_token', token); }
let activated=false;

// Simple file system
let fileSystem = {
  Desktop: [],
  Documents: [],
  Downloads: [
    { name: "Import File", type: "import" }
  ],
  Pictures: []
};

const desktopScreen = document.getElementById('desktopScreen');

// --- CLOCK WIDGET ---
function updateClock(){
  const now = new Date();
  const h = String(now.getHours()).padStart(2,'0');
  const m = String(now.getMinutes()).padStart(2,'0');
  const s = String(now.getSeconds()).padStart(2,'0');
  document.getElementById('clockWidget').textContent=`${h}:${m}:${s}`;
}
setInterval(updateClock,1000);
updateClock();

// Boot sequence
document.getElementById('bootScreen').style.display='flex';
setTimeout(()=>{
  document.getElementById('bootScreen').style.opacity=0;
  setTimeout(()=>{
    document.getElementById('bootScreen').style.display='none';
    document.getElementById('productKeyScreen').style.display='flex';
    document.getElementById('productKeyScreen').style.opacity=1;
  },500);
},7000);

// --- PRODUCT KEY ---
document.getElementById('submitKey').addEventListener('click',async ()=>{
  const key=document.getElementById('productKeyInput').value.trim();
  if(!key){ alert("Enter a key!"); return; }
  try{
    const keysResp = await fetch('https://raw.githack.com/easytypeneocitiesorg-lgtm/browser-OS/main/keys.txt');
    const keysTxt=await keysResp.text();
    const keys=keysTxt.split('/').map(k=>k.trim()).filter(Boolean);
    if(!keys.includes(key)){ alert("Key not found"); return; }

    const bindings=JSON.parse(localStorage.getItem('bos_bindings')||'{}');
    if(!bindings[key]){ bindings[key]=token; localStorage.setItem('bos_bindings',JSON.stringify(bindings)); activated=true; startDesktop(); }
    else if(bindings[key]===token){ activated=true; startDesktop(); }
    else { alert("Key already used by another device"); }
  }catch(e){ console.error(e); alert("Error fetching keys"); }
});

document.getElementById('skipKey').addEventListener('click',()=>{
  activated=false; startDesktop();
});

// --- START DESKTOP ---
function startDesktop(){
  document.getElementById('productKeyScreen').style.opacity=0;
  setTimeout(()=>{
    document.getElementById('productKeyScreen').style.display='none';
    desktopScreen.style.display='flex';
    desktopScreen.style.opacity=1;
    if(!activated) document.getElementById('watermark').style.display='block';

    // Show imported and .bof files on desktop
    renderDesktopIcons();
  },500);
}

function renderDesktopIcons(){
  document.querySelectorAll('#desktopScreen .icon-imported').forEach(el=>el.remove());
  let x = 200, y = 50, counter = 0;
  fileSystem.Desktop.forEach(f=>{
      const icon=document.createElement('div');
      icon.className='icon icon-imported';
      icon.style.left=`${x}px`;
      icon.style.top=`${y}px`;
      let img="https://img.icons8.com/fluency/48/document.png";
      if(f.type==='bof') img="https://img.icons8.com/fluency/48/source-code.png";
      icon.innerHTML=`<img src="${img}"/><span>${f.name}</span>`;
      icon.ondblclick=()=>{
        if(f.type==='html' || f.type==='bof'){
          createWindow(f.name, `<iframe srcdoc='${f.content.replace(/'/g,"&#39;")}' style='width:100%;height:100%;'></iframe>`);
        }
      };
      makeIconDraggable(icon,f);
      desktopScreen.appendChild(icon);
      counter++;
      x += 100;
      if(counter % 5 === 0){ x = 200; y += 100; }
  });
}

// --- DRAG & DROP ICONS WITH RECYCLE BIN ---
function makeIconDraggable(icon,file){
  icon.onmousedown=function(e){
    let shiftX=e.clientX-icon.getBoundingClientRect().left;
    let shiftY=e.clientY-icon.getBoundingClientRect().top;
    function moveAt(pageX,pageY){ icon.style.left=pageX-shiftX+'px'; icon.style.top=pageY-shiftY+'px'; }
    function onMouseMove(e){ moveAt(e.pageX,e.pageY); }
    document.addEventListener('mousemove',onMouseMove);
    icon.onmouseup=function(e){
      document.removeEventListener('mousemove',onMouseMove);
      icon.onmouseup=null;
      const recycle=document.getElementById('iconRecycle').getBoundingClientRect();
      if(e.clientX>recycle.left && e.clientX<recycle.right && e.clientY>recycle.top && e.clientY<recycle.bottom){
        if(file.type==='html'||file.type==='bof'){
          fileSystem.Desktop=fileSystem.Desktop.filter(f=>f!==file);
          icon.remove();
        }
      }
    };
  };
  icon.ondragstart=()=>false;
}

// --- FILE EXPLORER ---
document.getElementById('iconExplorer').addEventListener('dblclick',()=>{
  if(!activated){ alert("Activate BrowserOS to use File Explorer."); return; }
  createExplorerWindow("File Explorer", "Downloads");
});

function renderExplorer(path){
  const folder=fileSystem[path];
  let html=`<div class="breadcrumbs">Current folder: ${path}</div>`;
  html+='<ul class="folder-list">';
  folder.forEach(f=>{
    if(f.type==='import') html+=`<li class="file-import">${f.name}</li>`;
    else if(f.type==='html') html+=`<li class="file-html">${f.name}</li>`;
    else if(f.type==='bof') html+=`<li class="file-bof">${f.name}</li>`;
    else html+=`<li class="folder">${f.name}</li>`;
  });
  html+='</ul>';
  return html;
}

function createExplorerWindow(title, initialFolder){
  const win=document.createElement('div'); win.className='window'; win.style.top='100px'; win.style.left='100px';
  const header=document.createElement('div'); header.className='window-header'; header.innerHTML=`<span>${title}</span>`;
  const buttons=document.createElement('div'); buttons.className='window-buttons';
  const minBtn=document.createElement('button'); minBtn.textContent='—';
  const closeBtn=document.createElement('button'); closeBtn.textContent='✕';
  buttons.appendChild(minBtn); buttons.appendChild(closeBtn); header.appendChild(buttons);
  win.appendChild(header);
  const contentDiv=document.createElement('div'); contentDiv.className='window-content';
  win.appendChild(contentDiv);
  desktopScreen.appendChild(win);

  let currentFolder = initialFolder;

  function refreshContent(){
    contentDiv.innerHTML = renderExplorer(currentFolder);
    const items = contentDiv.querySelectorAll('li');
    items.forEach(item=>{
      item.addEventListener('dblclick',()=>{
        if(item.classList.contains('folder')){
          if(fileSystem[item.textContent]){ currentFolder=item.textContent; refreshContent(); }
        } else if(item.classList.contains('file-import')){
          if(!activated){ alert("Activate BrowserOS to import files."); return; }
          const htmlContent=prompt("Enter HTML content for new file:");
          if(htmlContent){
            const fileName="ImportedFile_"+Date.now()+".html";
            fileSystem.Downloads.push({name:fileName,type:'html',content:htmlContent});
            refreshContent();
            renderDesktopIcons();
          }
        } else if(item.classList.contains('file-html')){
          const file=fileSystem.Downloads.find(f=>f.name===item.textContent);
          if(file){
            createWindow(file.name, `<iframe srcdoc='${file.content.replace(/'/g,"&#39;")}' style='width:100%;height:100%;'></iframe>`);
          }
        } else if(item.classList.contains('file-bof')){
          const file=fileSystem.Desktop.find(f=>f.name===item.textContent);
          if(file){
            createWindow(file.name, `<iframe srcdoc='${file.content.replace(/'/g,"&#39;")}' style='width:100%;height:100%;'></iframe>`);
          }
        }
      });
    });
  }

  refreshContent();

  // Drag
  header.onmousedown=function(e){
    let shiftX=e.clientX-win.getBoundingClientRect().left;
    let shiftY=e.clientY-win.getBoundingClientRect().top;
    function moveAt(pageX,pageY){ win.style.left=pageX-shiftX+'px'; win.style.top=pageY-shiftY+'px'; }
    function onMouseMove(e){ moveAt(e.pageX,e.pageY); }
    document.addEventListener('mousemove',onMouseMove);
    document.onmouseup=function(){ document.removeEventListener('mousemove',onMouseMove); document.onmouseup=null; };
  };
  header.ondragstart=()=>false;

  closeBtn.addEventListener('click',()=>{ win.remove(); });
  minBtn.addEventListener('click',()=>{
    win.style.display='none';
    const taskbar=document.getElementById('minimizedApps');
    const tbIcon=document.createElement('button'); tbIcon.textContent=title;
    tbIcon.addEventListener('click',()=>{ win.style.display='flex'; taskbar.removeChild(tbIcon); });
    taskbar.appendChild(tbIcon);
  });
}

// --- CREATE NEW .BOF FILE (ONLY IF ACTIVATED) ---
document.getElementById('newBOF').addEventListener('click',()=>{
  if(!activated){ alert("Activate BrowserOS to create .bof files."); return; }
  const win=document.createElement('div'); win.className='window'; win.style.top='100px'; win.style.left='100px';
  const header=document.createElement('div'); header.className='window-header'; header.innerHTML='<span>New .bof File</span>';
  const btns=document.createElement('div'); const saveBtn=document.createElement('button'); saveBtn.textContent='Save'; btns.appendChild(saveBtn);
  header.appendChild(btns); win.appendChild(header);
  const content=document.createElement('div'); content.className='window-content';
  content.innerHTML='<textarea id="bofEditor" style="width:100%;height:100%;"></textarea>'; win.appendChild(content);
  desktopScreen.appendChild(win);

  // Drag window
  header.onmousedown=function(e){
    let sx=e.clientX-win.getBoundingClientRect().left;
    let sy=e.clientY-win.getBoundingClientRect().top;
    function moveAt(px,py){ win.style.left=px-sx+'px'; win.style.top=py-sy+'px'; }
    function onMouseMove(e){ moveAt(e.pageX,e.pageY); }
    document.addEventListener('mousemove',onMouseMove);
    document.onmouseup=function(){ document.removeEventListener('mousemove',onMouseMove); document.onmouseup=null; };
  };

  saveBtn.onclick=()=>{
    const code=document.getElementById('bofEditor').value;
    const fileName="NewFile_"+Date.now()+".bof";
    fileSystem.Desktop.push({name:fileName,type:'bof',content:code});
    win.remove();
    renderDesktopIcons();
  };
});

// --- CALCULATOR ---
document.getElementById('iconCalculator').ondblclick=()=>{
  createWindow("Calculator",
    `<p>Simple Calculator</p><input id="calcInput" type="text" style="width:100%;"/><button onclick="document.getElementById('calcInput').value=eval(document.getElementById('calcInput').value)">=</button>`
  );
};

// --- BROWSER ---
document.getElementById('iconBrowser').ondblclick=()=>{
  createWindow("Internet Browser",
    `<input id="browserUrl" type="text" placeholder="Enter URL" style="width:80%;"/><button onclick="this.nextElementSibling.src=document.getElementById('browserUrl').value">Go</button><iframe src="https://example.com" style="width:100%;height:150px;margin-top:5px;"></iframe>`
  );
};

// --- WALLPAPER ---
document.getElementById('iconWallpaper').ondblclick=()=>{
  if(!activated) return;
  const url=prompt("Enter image URL:");
  if(url) desktopScreen.style.backgroundImage=`url(${url})`;
};

// --- START MENU ---
const startBtn=document.getElementById('startButton');
const startMenu=document.getElementById('startMenu');
startBtn.onclick=()=>{ startMenu.style.display=startMenu.style.display==='flex'?'none':'flex'; };

// --- SHUTDOWN ---
document.getElementById('shutdownButton').onclick=()=>{
  desktopScreen.style.opacity=0;
  setTimeout(()=>{
    desktopScreen.style.display='none';
    document.getElementById('shutdownScreen').style.display='flex';
    document.getElementById('shutdownScreen').style.opacity=1;
  },500);
};
</script>
</body>
</html>
