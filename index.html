<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WebOS</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: url('https://wallpaperaccess.com/full/3132286.jpg') center/cover no-repeat;
    font-family: 'Segoe UI', sans-serif;
  }
  .desktop {
    position: relative;
    width: 100vw;
    height: 100vh;
  }
  .icon {
    position: absolute;
    width: 80px;
    text-align: center;
    color: white;
    cursor: pointer;
    user-select: none;
  }
  .icon img {
    width: 64px;
    height: 64px;
  }
  .window {
    position: absolute;
    width: 420px;
    height: 320px;
    background: #f0f0f0;
    border: 1px solid #888;
    border-radius: 6px;
    box-shadow: 0 0 10px rgba(0,0,0,0.4);
    overflow: hidden;
  }
  .titlebar {
    background: linear-gradient(#2b5797, #1a3b6e);
    color: white;
    padding: 5px;
    cursor: move;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 600;
  }
  .close {
    background: red;
    width: 22px;
    height: 22px;
    text-align: center;
    line-height: 22px;
    border-radius: 3px;
    cursor: pointer;
  }
  iframe {
    width: 100%;
    height: calc(100% - 32px);
    border: none;
  }
  button {
    font-size: 16px;
    width: 23%;
    margin: 2px;
  }
</style>
</head>
<body>
<div class="desktop" id="desktop">
  <div class="icon" style="top:20px;left:20px;" ondblclick="openApp('recycle')">
    <img src="https://icons.iconarchive.com/icons/microsoft/windows-10/512/Recycle-Bin-Full-icon.png">
    <div>Recycle Bin</div>
  </div>
  <div class="icon" style="top:120px;left:20px;" ondblclick="openApp('calc')">
    <img src="https://icons.iconarchive.com/icons/microsoft/windows-10/512/Calculator-icon.png">
    <div>Calculator</div>
  </div>
  <div class="icon" style="top:220px;left:20px;" ondblclick="openApp('explorer')">
    <img src="https://icons.iconarchive.com/icons/microsoft/windows-10/512/File-Explorer-icon.png">
    <div>File Explorer</div>
  </div>
  <div class="icon" style="top:320px;left:20px;" ondblclick="openApp('browser')">
    <img src="https://icons.iconarchive.com/icons/microsoft/windows-10/512/Edge-icon.png">
    <div>Browser</div>
  </div>
</div>

<script>
let z = 1;

function makeDraggable(win, bar){
  let offsetX, offsetY, dragging = false;
  bar.addEventListener('mousedown', e=>{
    dragging = true;
    offsetX = e.clientX - win.offsetLeft;
    offsetY = e.clientY - win.offsetTop;
    win.style.zIndex = ++z;
  });
  document.addEventListener('mouseup', ()=> dragging = false);
  document.addEventListener('mousemove', e=>{
    if(!dragging) return;
    win.style.left = e.clientX - offsetX + 'px';
    win.style.top = e.clientY - offsetY + 'px';
  });
}

function createWindow(title, content){
  const w = document.createElement('div');
  w.className='window';
  w.style.top = '100px';
  w.style.left = '100px';
  w.style.zIndex = ++z;

  const t = document.createElement('div');
  t.className='titlebar';
  const txt = document.createElement('span');
  txt.textContent = title;

  const c = document.createElement('div');
  c.className='close';
  c.textContent='Ã—';
  c.onclick = () => {
    w.remove(); // window properly closes and does not bug out
  };

  t.append(txt, c);
  w.append(t, content);
  document.body.append(w);
  makeDraggable(w, t);
  return w;
}

function openApp(app){
  if(app === 'recycle'){
    let c = document.createElement('div');
    c.innerHTML = '<p style="padding:10px;">Recycle Bin is empty.</p>';
    createWindow('Recycle Bin', c);
  } 
  else if(app === 'calc'){
    let c = document.createElement('div');
    c.style.padding = '5px';
    c.innerHTML = `
      <input id="calcInput" style="width:100%;font-size:20px;" readonly><br>
      ${['7','8','9','/','4','5','6','*','1','2','3','-','0','.','=','+']
        .map(b=>`<button onclick="calcPress('${b}')">${b}</button>`).join('')}
    `;
    createWindow('Calculator', c);
  } 
  else if(app === 'explorer'){
    let c = document.createElement('div');
    c.style.padding = '10px';
    c.innerHTML = '<ul><li ondblclick="openWallpaper()">wallpaper.jpg</li></ul>';
    createWindow('File Explorer', c);
  } 
  else if(app === 'browser'){
    let c = document.createElement('div');
    c.innerHTML = `
      <input id="url" placeholder="Enter URL" style="width:100%;box-sizing:border-box;padding:4px;">
      <iframe id="frame"></iframe>
    `;
    const w = createWindow('Browser', c);
    const urlInput = c.querySelector('#url');
    const frame = c.querySelector('#frame');
    urlInput.addEventListener('keydown', e=>{
      if(e.key==='Enter'){
        let val = urlInput.value.trim();
        if(!val.startsWith('http')) val = 'https://' + val;
        frame.src = val;
      }
    });
  }
}

function calcPress(v){
  let i = document.getElementById('calcInput');
  if(!i) return;
  if(v==='='){
    try { i.value = eval(i.value); }
    catch { i.value = 'Error'; }
  } else i.value += v;
}

function openWallpaper(){
  const choice = prompt('Type 1 to upload a file, or 2 to use an image link:');
  if(choice === '1'){
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/png,image/jpeg';
    input.onchange = e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        document.body.style.background = `url('${reader.result}') center/cover no-repeat`;
      };
      reader.readAsDataURL(file);
    };
    input.click();
  } else if(choice === '2'){
    const link = prompt('Enter image URL:');
    if(link) document.body.style.background = `url('${link}') center/cover no-repeat`;
  }
}
</script>
</body>
</html>
